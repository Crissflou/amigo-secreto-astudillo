<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Ruleta Amigo Secreto - Familia Astudillo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    body { min-height: 100vh; display: flex; justify-content: center; align-items: center; background: radial-gradient(circle at top, #ffe8f2, #f5f5ff); color: #222; padding: 1.5rem; }
    .card { background: #ffffffee; max-width: 480px; width: 100%; border-radius: 24px; box-shadow: 0 24px 48px rgba(0, 0, 0, 0.16); padding: 2rem 1.8rem 2.2rem; text-align: center; }
    .family-title {
      font-size: 1.9rem; font-weight: 800; margin-bottom: 0.15rem;
      background: conic-gradient(from 180deg,#f97316,#eab308,#22c55e,#14b8a6,#3b82f6,#a855f7,#ec4899,#f97316);
      -webkit-background-clip: text; background-clip: text; color: transparent; letter-spacing: 0.06em; text-transform: uppercase;
    }
    .event-title { font-size: 1.1rem; font-weight: 600; color: #4b5563; margin-bottom: 0.6rem; }
    .subtitle { font-size: 0.95rem; color: #555; margin-bottom: 1.1rem; line-height: 1.4; }
    .participant-name { font-weight: 600; color: #7c3aed; }

    .roulette-wrapper { margin: 1.6rem auto 1.2rem; display: flex; justify-content: center; align-items: center; }
    .roulette-circle {
      width: 210px; height: 210px; border-radius: 50%;
      background: conic-gradient(#fecaca, #fef3c7, #bbf7d0, #bfdbfe, #e9d5ff, #fecaca);
      display: flex; justify-content: center; align-items: center;
      position: relative; overflow: hidden;
      box-shadow: 0 0 0 7px #fff, 0 14px 28px rgba(0, 0, 0, 0.2);
    }
    .roulette-inner {
      width: 82%; height: 82%; border-radius: 50%;
      background: radial-gradient(circle at top, #ffffff, #f4f4ff);
      display: flex; align-items: center; justify-content: center;
      font-size: 3.2rem; font-weight: 700;
    }
    .roulette-circle.spinning { animation: spin 3.6s ease-out forwards; }
    @keyframes spin { 0% { transform: rotate(0deg); } 70% { transform: rotate(1980deg); } 100% { transform: rotate(1860deg); } }

    .pointer {
      width: 0; height: 0;
      border-left: 13px solid transparent;
      border-right: 13px solid transparent;
      border-bottom: 22px solid #ef4444;
      position: absolute; top: -4px; left: 50%;
      transform: translateX(-50%);
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.25));
    }

    .btn {
      display: inline-block; margin-top: 0.4rem;
      padding: 0.75rem 1.6rem; border-radius: 999px;
      border: none; font-size: 1rem; font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #6366f1, #a855f7);
      color: white;
      box-shadow: 0 12px 22px rgba(99, 102, 241, 0.4);
      transition: transform 0.12s ease, box-shadow 0.12s ease, opacity 0.12s ease;
    }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 16px 26px rgba(99, 102, 241, 0.5); }
    .btn:active { transform: translateY(1px) scale(0.98); box-shadow: 0 9px 17px rgba(79, 70, 229, 0.45); }
    .btn:disabled { opacity: 0.6; cursor: default; box-shadow: none; transform: none; }

    .result-box { margin-top: 1.6rem; text-align: left; background: #f9fafb; border-radius: 16px; padding: 1rem 1.15rem; border: 1px solid #e5e7eb; }
    .result-title { font-size: 1rem; font-weight: 600; margin-bottom: 0.2rem; }
    .result-name { font-size: 1.15rem; font-weight: 700; color: #16a34a; margin-bottom: 0.5rem; }
    .gift-title { font-size: 0.93rem; font-weight: 600; margin-bottom: 0.3rem; }
    .gift-list { font-size: 0.9rem; margin-left: 1.1rem; margin-top: 0.2rem; color: #374151; }
    .gift-list li { margin-bottom: 0.12rem; }

    .info-text { margin-top: 0.7rem; font-size: 0.8rem; color: #6b7280; }
    .error { color: #b91c1c; font-size: 0.95rem; margin-top: 1rem; }
    .small-note { margin-top: 0.9rem; font-size: 0.8rem; color: #7c3aed; font-weight: 500; }

    @media (max-width: 480px) {
      body { padding: 1rem; }
      .card { padding: 1.5rem 1.2rem 1.8rem; border-radius: 20px; }
      .family-title { font-size: 1.6rem; }
      .event-title { font-size: 1rem; }
      .roulette-circle { width: 190px; height: 190px; }
      .roulette-inner { font-size: 2.8rem; }
      .result-box { font-size: 0.9rem; }
    }
  </style>
</head>

<body>
  <div class="card">
    <h1 class="family-title">FAMILIA ASTUDILLOS</h1>
    <p class="event-title">Amigo Secreto</p>

    <p class="subtitle">
      Hola, <span id="participantName" class="participant-name"></span>.
      Gira la ruleta para descubrir a qui茅n te toc贸.
    </p>

    <div id="errorBox" class="error" style="display:none;"></div>

    <div id="rouletteSection" style="display:none;">
      <div class="roulette-wrapper">
        <div class="roulette-circle" id="rouletteCircle">
          <div class="pointer"></div>
          <div class="roulette-inner"></div>
        </div>
      </div>

      <button id="spinBtn" class="btn">Girar ruleta</button>
      <p class="small-note">Solo puedes girar una vez; tu resultado quedar谩 guardado en este dispositivo.</p>

      <div id="resultBox" class="result-box" style="display:none;">
        <div class="result-title">Te toc贸 como amigo secreto:</div>
        <div id="resultName" class="result-name"></div>

        <div class="gift-title">Ideas de regalo sugeridas:</div>
        <ul id="giftList" class="gift-list"></ul>

        <p class="info-text">
          Este resultado es solo para ti. No compartas tu enlace si quieren mantener la sorpresa.
        </p>
      </div>
    </div>
  </div>

  <script>
    // Tokens privados -> resultado (asignaci贸n 煤nica, sin repetidos, sin auto-asignaci贸n)
    // IMPORTANTE: el usuario se identifica SOLO por token (?token=...)
    const byToken = {
      "evelyn_q4m7z": {
        name: "Evelyn",
        target: "Antonia",
        gifts: [
          "Set de atril 1,50 + Bastidores + Pinceles + pinturas + paleta",
          "Carrito organizador con ruedas tipo velador, 4 cajones beige",
          "Crema hidratante CeraVe 450g"
        ]
      },
      "andrea_h9k2p": {
        name: "Andrea",
        target: "Maximo",
        gifts: [
          "Reloj Casio rojo (F150 o F90)",
          "Poleras de pique con cuello 3XL (blanco o negro) para la pega",
          "Chaqueta (no poler贸n)"
        ]
      },
      "antonia_r5t8n": {
        name: "Antonia",
        target: "Cristobal",
        gifts: [
          "Colchoneta grande de ejercicios",
          "Ajedrez de madera",
          "Adaptador USB 3.0 a RJ45 Gigabit Ethernet"
        ]
      },
      "matias_c3v6x": {
        name: "Matias",
        target: "Marcelo",
        gifts: [
          "Lapidus Pour Homme 100ml EDT Hombre (Ted Lapidus)",
          "Gafas de sol para hombre (lentes moda)",
          "Billetera tarjetero cuero hombre minimalista con RFID (Slowton)"
        ]
      },
      "papi_j7s1d": {
        name: "Papi",
        target: "Andrea",
        gifts: [
          "Neorayen"
        ]
      },
      "maximo_w2f9g": {
        name: "Maximo",
        target: "Sebita",
        gifts: [
          "Control inal谩mbrico Redragon Harrow Pro G808 (o similar)",
          "Bestway balsa inflable Hydro-Force"
        ]
      },
      "cristina_b8l4q": {
        name: "Cristina",
        target: "Papi",
        gifts: [
          "Polera cuello redondo",
          "Joquey",
          "Calcetines"
        ]
      },
      "mami_u6y3h": {
        name: "Mami",
        target: "Cristina",
        gifts: [
          "Toalla grande microfibra",
          "Un joyero",
          "Una polera"
        ]
      },
      "marcelo_n1p7k": {
        name: "Marcelo",
        target: "Catalina",
        gifts: [
          "Bio Active Skin Care crema de d铆a (p茅ptidos y retinol)",
          "Bio Active Skin Care crema de noche (p茅ptidos y retinol)",
          "Niacinamide crema en gel 50 ml"
        ]
      },
      "sebita_t9c2m": {
        name: "Sebita",
        target: "Matias",
        gifts: [
          "Argollas b谩sicas tradicionales enchapadas en oro",
          "Calcetines largos Solid 3 pares (unisex Adidas)",
          "Base cooler ventilador para notebook (negro/azul)",
          "Revox B77 Serum Facial Vitamin C 20%"
        ]
      },
      "cristobal_v5r8a": {
        name: "Cristobal",
        target: "Mami",
        gifts: [
          "Cadena de plata"
        ]
      },
      "catalina_x2d6e": {
        name: "Catalina",
        target: "Evelyn",
        gifts: [
          "Protector solar facial ISDIN Magic Repair Color SPF",
          "Crema hidratante CeraVe 455g",
          "Protector solar Hawaiian Tropic loci贸n Ultra Radiance + bronceador SPF",
          "Protector solar rostro Anthelios UVMune 400 (sin color)",
          "Cosmetiquero"
        ]
      }
    };

    const params = new URLSearchParams(window.location.search);
    const token = (params.get("token") || "").trim();

    const participantNameEl = document.getElementById("participantName");
    const rouletteSectionEl = document.getElementById("rouletteSection");
    const errorBoxEl = document.getElementById("errorBox");
    const spinBtn = document.getElementById("spinBtn");
    const rouletteCircle = document.getElementById("rouletteCircle");
    const resultBoxEl = document.getElementById("resultBox");
    const resultNameEl = document.getElementById("resultName");
    const giftListEl = document.getElementById("giftList");

    const STORAGE_PREFIX = "amigoSecretoResultado-token-";
    const userData = byToken[token];

    if (!token || !userData) {
      errorBoxEl.style.display = "block";
      errorBoxEl.textContent = "Enlace inv谩lido o incompleto. Revisa que abriste el link correcto.";
    } else {
      participantNameEl.textContent = userData.name;
      rouletteSectionEl.style.display = "block";

      const saved = localStorage.getItem(STORAGE_PREFIX + token);
      if (saved) {
        const parsed = JSON.parse(saved);
        mostrarResultado(parsed.target, parsed.gifts);
        spinBtn.disabled = true;
      }

      spinBtn.addEventListener("click", () => {
        if (spinBtn.disabled) return;

        spinBtn.disabled = true;
        rouletteCircle.classList.remove("spinning");
        void rouletteCircle.offsetWidth;
        rouletteCircle.classList.add("spinning");

        setTimeout(() => {
          const target = userData.target;
          const gifts = userData.gifts || [];
          mostrarResultado(target, gifts);

          localStorage.setItem(STORAGE_PREFIX + token, JSON.stringify({ target, gifts }));
        }, 3650);
      });
    }

    function mostrarResultado(targetName, gifts) {
      resultNameEl.textContent = targetName;
      giftListEl.innerHTML = "";

      if (Array.isArray(gifts) && gifts.length > 0) {
        gifts.forEach(g => {
          const li = document.createElement("li");
          li.textContent = g;
          giftListEl.appendChild(li);
        });
      } else {
        const li = document.createElement("li");
        li.textContent = "Elige un detalle que sepas que le gusta: un regalo personalizado suele ser lo mejor.";
        giftListEl.appendChild(li);
      }

      resultBoxEl.style.display = "block";
    }
  </script>
</body>
</html>
